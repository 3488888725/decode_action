var _0xodR='jsjiami.cn.v7';const _0x53a2ad=_0x8194;(function(_0x420753,_0x32f458,_0x561656,_0x3bf820,_0x45d686,_0x49ccb3,_0x30e5b7){return _0x420753=_0x420753>>0x4,_0x49ccb3='hs',_0x30e5b7='hs',function(_0x257735,_0x3984fa,_0x1c67f0,_0x54a383,_0x5e179a){const _0x35ad2c=_0x8194;_0x54a383='tfi',_0x49ccb3=_0x54a383+_0x49ccb3,_0x5e179a='up',_0x30e5b7+=_0x5e179a,_0x49ccb3=_0x1c67f0(_0x49ccb3),_0x30e5b7=_0x1c67f0(_0x30e5b7),_0x1c67f0=0x0;const _0x48eeb7=_0x257735();while(!![]&&--_0x3bf820+_0x3984fa){try{_0x54a383=parseInt(_0x35ad2c(0x1b8,'kP$@'))/0x1*(-parseInt(_0x35ad2c(0x1d0,'Mt[t'))/0x2)+parseInt(_0x35ad2c(0x19d,'Fxm('))/0x3*(parseInt(_0x35ad2c(0x1df,'eTsS'))/0x4)+-parseInt(_0x35ad2c(0x1c5,'eNw$'))/0x5*(parseInt(_0x35ad2c(0x1a4,'57n%'))/0x6)+-parseInt(_0x35ad2c(0x1f7,'tvX$'))/0x7+parseInt(_0x35ad2c(0x19c,'wM%F'))/0x8+-parseInt(_0x35ad2c(0x19a,'2I8o'))/0x9+parseInt(_0x35ad2c(0x1c9,'(OyK'))/0xa;}catch(_0x4e50b0){_0x54a383=_0x1c67f0;}finally{_0x5e179a=_0x48eeb7[_0x49ccb3]();if(_0x420753<=_0x3bf820)_0x1c67f0?_0x45d686?_0x54a383=_0x5e179a:_0x45d686=_0x5e179a:_0x1c67f0=_0x5e179a;else{if(_0x1c67f0==_0x45d686['replace'](/[LVQqweTbghOkrulHyptf=]/g,'')){if(_0x54a383===_0x3984fa){_0x48eeb7['un'+_0x49ccb3](_0x5e179a);break;}_0x48eeb7[_0x30e5b7](_0x5e179a);}}}}}(_0x561656,_0x32f458,function(_0x145be6,_0x375a3e,_0x436828,_0x16586e,_0x3bb95a,_0x4dc975,_0x585053){return _0x375a3e='\x73\x70\x6c\x69\x74',_0x145be6=arguments[0x0],_0x145be6=_0x145be6[_0x375a3e](''),_0x436828=`\x72\x65\x76\x65\x72\x73\x65`,_0x145be6=_0x145be6[_0x436828]('\x76'),_0x16586e=`\x6a\x6f\x69\x6e`,(0x17bae2,_0x145be6[_0x16586e](''));});}(0xbd0,0x2c52a,_0x48f7,0xbf),_0x48f7)&&(_0xodR=_0x53a2ad(0x1e1,'zgkA'));function _0x8194(_0x5923f3,_0x5a42f5){const _0x110105=_0x48f7();return _0x8194=function(_0x91ca88,_0x143647){_0x91ca88=_0x91ca88-0x192;let _0x48f7ea=_0x110105[_0x91ca88];if(_0x8194['ncWXcq']===undefined){var _0x8194ec=function(_0x43c66d){const _0x24c981='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x5a2728='',_0x46c438='',_0xa9f47d=_0x5a2728+_0x8194ec;for(let _0x1d8d05=0x0,_0xdad8ce,_0x1abf5c,_0x3e37d5=0x0;_0x1abf5c=_0x43c66d['charAt'](_0x3e37d5++);~_0x1abf5c&&(_0xdad8ce=_0x1d8d05%0x4?_0xdad8ce*0x40+_0x1abf5c:_0x1abf5c,_0x1d8d05++%0x4)?_0x5a2728+=_0xa9f47d['charCodeAt'](_0x3e37d5+0xa)-0xa!==0x0?String['fromCharCode'](0xff&_0xdad8ce>>(-0x2*_0x1d8d05&0x6)):_0x1d8d05:0x0){_0x1abf5c=_0x24c981['indexOf'](_0x1abf5c);}for(let _0x365def=0x0,_0x4f1c33=_0x5a2728['length'];_0x365def<_0x4f1c33;_0x365def++){_0x46c438+='%'+('00'+_0x5a2728['charCodeAt'](_0x365def)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x46c438);};const _0x118893=function(_0xd1342c,_0x55ce8f){let _0x6f9df5=[],_0x2035d7=0x0,_0x2ec528,_0x59fd71='';_0xd1342c=_0x8194ec(_0xd1342c);let _0x217d51;for(_0x217d51=0x0;_0x217d51<0x100;_0x217d51++){_0x6f9df5[_0x217d51]=_0x217d51;}for(_0x217d51=0x0;_0x217d51<0x100;_0x217d51++){_0x2035d7=(_0x2035d7+_0x6f9df5[_0x217d51]+_0x55ce8f['charCodeAt'](_0x217d51%_0x55ce8f['length']))%0x100,_0x2ec528=_0x6f9df5[_0x217d51],_0x6f9df5[_0x217d51]=_0x6f9df5[_0x2035d7],_0x6f9df5[_0x2035d7]=_0x2ec528;}_0x217d51=0x0,_0x2035d7=0x0;for(let _0x11bb69=0x0;_0x11bb69<_0xd1342c['length'];_0x11bb69++){_0x217d51=(_0x217d51+0x1)%0x100,_0x2035d7=(_0x2035d7+_0x6f9df5[_0x217d51])%0x100,_0x2ec528=_0x6f9df5[_0x217d51],_0x6f9df5[_0x217d51]=_0x6f9df5[_0x2035d7],_0x6f9df5[_0x2035d7]=_0x2ec528,_0x59fd71+=String['fromCharCode'](_0xd1342c['charCodeAt'](_0x11bb69)^_0x6f9df5[(_0x6f9df5[_0x217d51]+_0x6f9df5[_0x2035d7])%0x100]);}return _0x59fd71;};_0x8194['iuVTBe']=_0x118893,_0x5923f3=arguments,_0x8194['ncWXcq']=!![];}const _0x4e95a1=_0x110105[0x0],_0x5f1639=_0x91ca88+_0x4e95a1,_0x361a70=_0x5923f3[_0x5f1639];if(!_0x361a70){if(_0x8194['rUJDKm']===undefined){const _0x3b8db1=function(_0x4de2a8){this['GgJJsv']=_0x4de2a8,this['uwqNXg']=[0x1,0x0,0x0],this['GXbeMl']=function(){return'newState';},this['lJwLac']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['kJOmfZ']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x3b8db1['prototype']['ZDZqyW']=function(){const _0x1d5d62=new RegExp(this['lJwLac']+this['kJOmfZ']),_0x555357=_0x1d5d62['test'](this['GXbeMl']['toString']())?--this['uwqNXg'][0x1]:--this['uwqNXg'][0x0];return this['jSQtMN'](_0x555357);},_0x3b8db1['prototype']['jSQtMN']=function(_0x476221){if(!Boolean(~_0x476221))return _0x476221;return this['YNLGXy'](this['GgJJsv']);},_0x3b8db1['prototype']['YNLGXy']=function(_0x37bfbd){for(let _0x1da749=0x0,_0x5da310=this['uwqNXg']['length'];_0x1da749<_0x5da310;_0x1da749++){this['uwqNXg']['push'](Math['round'](Math['random']())),_0x5da310=this['uwqNXg']['length'];}return _0x37bfbd(this['uwqNXg'][0x0]);},new _0x3b8db1(_0x8194)['ZDZqyW'](),_0x8194['rUJDKm']=!![];}_0x48f7ea=_0x8194['iuVTBe'](_0x48f7ea,_0x143647),_0x5923f3[_0x5f1639]=_0x48f7ea;}else _0x48f7ea=_0x361a70;return _0x48f7ea;},_0x8194(_0x5923f3,_0x5a42f5);}const _0x5a28c0=(function(){const _0x1f4b47=_0x53a2ad,_0x166f88={'pKqaR':_0x1f4b47(0x1a6,'n^T]'),'jBAAT':function(_0x35a7c7,_0x477c70){return _0x35a7c7===_0x477c70;},'mSkDj':_0x1f4b47(0x200,'zgkA'),'HpsuP':_0x1f4b47(0x1ac,'oom0')};let _0x2e4465=!![];return function(_0x34d563,_0x4eb711){const _0xe2cec0=_0x1f4b47;if(_0x166f88[_0xe2cec0(0x19e,'xcqU')](_0x166f88[_0xe2cec0(0x19f,'zMQd')],_0x166f88[_0xe2cec0(0x1e4,'brca')]))_0x27a6bd[_0xe2cec0(0x1aa,'c2p!')](_0x166f88[_0xe2cec0(0x1ae,'xA%5')]),_0x4b1211[_0xe2cec0(0x1bd,'zMQd')]({'body':_0xefc80f[_0xe2cec0(0x1bc,'TkUk')](_0x7a13c6)});else{const _0x492143=_0x2e4465?function(){const _0x201983=_0xe2cec0;if(_0x4eb711){const _0xcc0b9d=_0x4eb711[_0x201983(0x1ce,'n^T]')](_0x34d563,arguments);return _0x4eb711=null,_0xcc0b9d;}}:function(){};return _0x2e4465=![],_0x492143;}};}()),_0x4238ed=_0x5a28c0(this,function(){const _0xe7603c=_0x53a2ad,_0x2a51a2={'Levjm':_0xe7603c(0x1b7,'Yp#h')};return _0x4238ed[_0xe7603c(0x1d3,'QksB')]()[_0xe7603c(0x1cc,'#7Fq')](_0x2a51a2[_0xe7603c(0x1cb,'eNw$')])[_0xe7603c(0x1c7,'brca')]()[_0xe7603c(0x1af,'1zhc')](_0x4238ed)[_0xe7603c(0x19b,'GfZs')](_0x2a51a2[_0xe7603c(0x1dc,'2I8o')]);});function _0x48f7(){const _0x13caed=(function(){return[...[_0xodR,'ftHljslbjLikagrmyiw.rqcVgQnT.Lev7ehuqpO==','W4xdUd4TCYhcIutcNa','W7nqq0ZcRG','W5BcLmoyWP/cQCoWimkUW54QW5WspSoYnmo7WQ8kWOFdMmkRW7iiW59OfgxcHSoIW7iqvCoKcN7dK8kcxCkvwSobW4e','f8o/W48HW78','ESkYWOzRWO1vW47dSmkYFubCW63cHg/cImkXW4jJcSoCWQBcIG','W61FvglcHG','W6tdP3tcImkA','W4BdHZ0LtW','bqdcRCo5eZdcPmkeohpcPa','kcrWEI7dQsBcS8k8','W5L3q8kdmSkrWQ/dSqe6WQDdWRS','v8k4WQpcISknmSk7W7u','WRZdUvhcOSk7','jCo+BCoOoq','x8kLWPDPWPfvW47cJ8k3Aa','uxuWWR8','tCkGW5JdI8oJt8ouWO0LW7FcTmoP','W6JdSmkNwWvjqW','W5CgWOFdKCkd','vx5QWR4vW6HNWPhcTd0XnftcRvxdU2GNW4NdJHJcUSouW5NdPbDuWRpcOSkagxj0WRG','Cgy2WRhdRxZdKmogW6dcU8oNh8kdWPBdQIq6WQRcUJOAW7ldNLfcWQBdHq','W7ldOxtcJSkgAmo8WQjJ','vce+W6e','vx5QWR4vW6HNWPhcTd0Ona7cOe7dSI8RWO7dHWtdUSkvW47dTHztWQJcTG','WRVdSYO','v8oCWQa','qZOIW63dRhxdKuXG','rSkBEd16vdbNEY/cOCkC','WOT9WQVdLG','rCobEmkQ','WOiqWRdcSmomtW7dHq','WQjMWQZdLCkhW5RcRmoQW5mEgNHjWPVcPfiQWPX1kXSrW78','WQiHW5FdQCkrEN/cJa','W6r9WRpcPmouisBcNCoofc/dOse','cSoNW4i4W5aaWPRcImkIrvfSWRu','Df3cMCoFWPZdTr/cKSoCWRFcSCk2xZxdGmksDG','W7XfWPxcTCoK','W7S7DSkeW606','W6GmWQ7cQSkM'],...(function(){return[...['W5vDWQFdHvi','WRJdLYRcN8k8W7ldRHZdGa','yWldN8kAWOmTWQvKs3L3W5W','vLxcGSoaW4ldTr3cKSooWRJcUmkRvh7dGmkuzCkxW6G4','WOFcVh58radcLu/cOCkL','vCopx8k/s8odWQe8','WObcW4ZcHSoanSo5W6qFBmoKW6q','W6tdUCk0cvbHkdBdI8odWQ7dHXC','cmoPWOa','W6VdPMZcJSkjySo8W6P5WPP/zSoI','cSo3xW','uwv5','W5jrDhlcMSkYEK0C','CfxcLCooW4tcSb/cQmoBWQ8','bKf3ovK','WOjdha','WO03b8owCCoiW7JdSHy/WOrFWPnQwbXGW7NcNG','rCk3WQdcLCk/WQejW58Dfq','eGWqqJdcPmkkW4hdTJ8kmM9MW7vhWR5LlWVcTsZdScSJWQvzW7BcTq/cGSoYcCknWQfZz0dcKhVdReCdW7eqjCoGAG','WODNWQ/dM8kpW5NcPmkOWPacux0o','WOldLMlcU8kW','W54fWR7cRSkBW7apxSknkCkWW41tWP3dPSk0WQlcKmkk','WP4+W7FdQmkZ','B8oRE8kUuq','WQ7dMmkFuW','WO3cKXVcJZTAWRilW7hcNLTX','mSkAW4FcLmkY','WQZdTSkpEY4','WOzjbGddP8kk','W5yvWOhdNW','W7WpWQtcQa','mWScWOWW','ivxcLmorW5C','ab3cRmoN','W7hdMNn0WQZcQfpdQCkVWOZdNXxcL3hcQCk1A8oMWO4nomkjWPxdTmkIW6HyW7dcISoF','WOyqWO3cKSoLwGhdUa','xce3','mHyEWOy','W5ZdI0FdGG','WP5vz3ZcKCoOiG','WRZcSGG'],...(function(){return['Awm1kNFcVhJcO8k9E0H3FG','W5vcAM/cSa','ymknW4LpW7tdP8otoa','jmkHW77cImkr','W4nmWQxdHW','W7ldL8kPlNi','WRJdJcRcGG','WOHhhaddRG','nSoNWOlcKCkTaSoFW5fGWRFdRSk4hmkXEwtcHYWCW6vyW59otCouWOX6WPzThaLnyCkSaa','WQXrWQJdOSk2','fSo8WOlcJmkMaCkwW4j3','pwtdMZrMihVdI0CBWPhcT3BdJCkUWOpcKq','WOmlk8okAG','aSo4W44M','W6DOW74epG','D0JcNSok','mmkGcri','h8oSW40','taxcJCkatW','ugWWWRVdRtldGColW43cOCoQfmkkW4ldPsCNWQZcOa','WQuouSonfq','xsRdOa','r8k4W4VcUSoP','W6ffWPmIc8oluZ/dNmkLW4ZdMmoKW6xcGSo1WOaBW4vLamovWQe4WROQWODNtfyBpgBdGW5SimkZW64','W4VdLK8','Erm5zWlcJCkKWPKaWQ/dMaK','W6pcLmonWO7cOSo9','ah3cT0OXWQTLW6BcHmkLC8oUW5i','yeKEWQ4UztBdOa','x1yfWP/dIW','xr07W4ddQa','vCk8C2TFACkLuSoa','WPLiW7KQamosiG','yGe5W6pdPW','xKJcISogW5ZcUrRdMmkpW7xdOmoIeNdcSmkyA8knW6W5CqxcUJZdN8oIqSotkuJcTSoaemo9WQK/W4LBBCoNWPX4W4VcISkkW6/cRSkQDCknW5BdPwy9b8oPWQBdL03dPSogWOPCWR7dJSoRDCkeWO/cR8kHeKRcUCodldKfW4pdMapdOZtdU2vsuwnkgHGuuSouFfVcK8kXj8oklmoZmgeMWPxdK2nHt8keW6xdKxNcVWNcQvVcM8oSW4bSFJqIW5SBD8kpW6FcQCkyW5qjWOevyG','ge7dImozd8kBtCodb8o8dsu','W7i2oSk1W4b+sJJcUx8gW5JdLfWRiCo+WQ3cHa','W71PW7FdH0tcPtygW5FcG8kmWRJcJh4rdCouW7tdUCo5zmk/vd4gugC3W4Cjec0tFmoxhNddSsG'];}())];}())];}());_0x48f7=function(){return _0x13caed;};return _0x48f7();};_0x4238ed();const _0x55958b=new Env(_0x53a2ad(0x1f9,'CF9u'));let _0x1f1470=$response[_0x53a2ad(0x1f4,'5^Wo')],_0x1f136d=JSON[_0x53a2ad(0x1ee,'Mt[t')](_0x1f1470);console[_0x53a2ad(0x1f6,'0%ax')](_0x53a2ad(0x1c6,'zgkA'),JSON[_0x53a2ad(0x1cf,'L]WB')](_0x1f136d,null,0x2));const _0x3541f2=/id=(\d+)/,_0x50613a=$request[_0x53a2ad(0x199,'5^Wo')][_0x53a2ad(0x1fe,'HB6o')](_0x3541f2);if(_0x50613a){const _0x1d9001=_0x50613a[0x1],_0x5a09f4=_0x53a2ad(0x1ba,'DKIV')+_0x1d9001+_0x53a2ad(0x1f5,'oom0');console[_0x53a2ad(0x1d9,'DKIV')](_0x53a2ad(0x1bf,']24)'),_0x1d9001),console[_0x53a2ad(0x196,'wM%F')](_0x53a2ad(0x1d5,'qREM'),_0x5a09f4);const _0xaab978={'authority':_0x53a2ad(0x202,'04N3'),'accept':_0x53a2ad(0x1c0,'i8sm'),'origin':_0x53a2ad(0x1be,'DKIV'),'accept-encoding':_0x53a2ad(0x1ca,'u%$e'),'user-agent':_0x53a2ad(0x1a3,'u%$e'),'accept-language':_0x53a2ad(0x1a5,'#7Fq'),'referer':_0x53a2ad(0x1f0,'CC]H')};_0x55958b[_0x53a2ad(0x1dd,'HB6o')]({'url':_0x5a09f4,'headers':_0xaab978},function(_0x212a3b,_0x25d98c,_0x292882){const _0x50c480=_0x53a2ad,_0xdcd3d7={'pldgU':_0x50c480(0x1a9,'GfZs'),'NKweh':_0x50c480(0x1d1,'u%$e'),'tgltD':function(_0x36ea4a,_0x4b1aa1){return _0x36ea4a(_0x4b1aa1);},'uObFO':_0x50c480(0x1ab,'(OyK'),'ROige':function(_0x3163b3,_0x21f17e){return _0x3163b3===_0x21f17e;},'NNAjn':_0x50c480(0x1b4,'uSYU'),'RuEWZ':_0x50c480(0x1bb,'xcqU'),'PKiDJ':function(_0x191b4b,_0x4ab2d7){return _0x191b4b(_0x4ab2d7);},'YRtTy':_0x50c480(0x1e3,'j5q@'),'kDXyi':_0x50c480(0x1ff,'Yp#h')};if(_0x212a3b)console[_0x50c480(0x1ad,'TkUk')](_0xdcd3d7[_0x50c480(0x1e5,'QksB')],_0x212a3b),_0xdcd3d7[_0x50c480(0x1f8,'oom0')](_0x1d1b81,_0x1f136d);else{console[_0x50c480(0x1d9,'DKIV')](_0xdcd3d7[_0x50c480(0x1e9,'kP$@')],_0x292882);let _0x174d3e;try{_0xdcd3d7[_0x50c480(0x1a2,'zMQd')](_0xdcd3d7[_0x50c480(0x197,'Av%G')],_0xdcd3d7[_0x50c480(0x1b3,']24)')])?_0x174d3e=JSON[_0x50c480(0x1e2,']24)')](_0x292882):(_0x3143f1[_0x50c480(0x1e6,'kP$@')](_0xdcd3d7[_0x50c480(0x195,'KBdM')]),_0x216794[_0x50c480(0x1ec,'j5q@')]({'body':_0x1ac038[_0x50c480(0x1a0,'C6c6')](_0x2290af)}));}catch(_0x5b7917){console[_0x50c480(0x1ed,'Fxm(')](_0xdcd3d7[_0x50c480(0x1a8,'oom0')],_0x5b7917),_0xdcd3d7[_0x50c480(0x1fc,'qREM')](_0x1d1b81,_0x1f136d);return;}if(_0x174d3e&&_0x174d3e[_0x50c480(0x1c4,'QksB')]){console[_0x50c480(0x1f2,'zMQd')](_0xdcd3d7[_0x50c480(0x1fa,'i8sm')],JSON[_0x50c480(0x1a0,'C6c6')](_0x174d3e[_0x50c480(0x1eb,'lcnJ')],null,0x2));const _0x38745e=_0x1f136d[_0x50c480(0x1ea,'HB6o')](_0x174d3e[_0x50c480(0x1b6,'xcqU')]),_0x145342=Array[_0x50c480(0x1ef,'1zhc')](new Set(_0x38745e[_0x50c480(0x1d6,'Yp#h')](_0x1fafbe=>_0x1fafbe[_0x50c480(0x1de,'F437')])))[_0x50c480(0x192,'c2p!')](_0x1708f8=>_0x38745e[_0x50c480(0x1c3,'zgkA')](_0x1d271d=>_0x1d271d[_0x50c480(0x194,'xcqU')]===_0x1708f8));_0x145342[_0x50c480(0x1fd,'L]WB')]((_0x324df9,_0xd539a9)=>new Date(_0x324df9[_0x50c480(0x1db,'u%$e')])-new Date(_0xd539a9[_0x50c480(0x1b5,'(OyK')])),console[_0x50c480(0x1d8,'uSYU')](_0xdcd3d7[_0x50c480(0x203,'F437')],JSON[_0x50c480(0x1b0,'tvX$')](_0x145342,null,0x2)),_0x55958b[_0x50c480(0x207,'Cr!3')]({'body':JSON[_0x50c480(0x1da,'oom0')](_0x145342)});}else console[_0x50c480(0x1fb,'n^T]')](_0xdcd3d7[_0x50c480(0x1cd,'j5q@')]),_0x55958b[_0x50c480(0x1f3,'Fxm(')]({'body':JSON[_0x50c480(0x201,'Yp#h')](_0x1f136d)});}});}else console[_0x53a2ad(0x193,'57n%')](_0x53a2ad(0x198,'e&sb')),_0x55958b[_0x53a2ad(0x1f3,'Fxm(')]({'body':JSON[_0x53a2ad(0x1c1,'zMQd')](_0x1f136d)});function _0x1d1b81(_0x1a52e2){const _0x4a4c82=_0x53a2ad,_0x7466bb={'OiMHZ':_0x4a4c82(0x1e0,'$L@T')};console[_0x4a4c82(0x1b9,'lcnJ')](_0x7466bb[_0x4a4c82(0x205,'e&sb')]),_0x1a52e2[_0x4a4c82(0x204,'c2p!')]({'error':_0x7466bb[_0x4a4c82(0x1e8,'i8sm')]}),_0x55958b[_0x4a4c82(0x206,'u%$e')]({'body':JSON[_0x4a4c82(0x1a7,'xA%5')](_0x1a52e2)});}
//
function Env(t,e){class s{constructor(t){this.env=t}send(t,e="GET"){t="string"==typeof t?{url:t}:t;let s=this.get;"POST"===e&&(s=this.post);const i=new Promise(((e,i)=>{s.call(this,t,((t,s,o)=>{t?i(t):e(s)}))}));return t.timeout?((t,e=1e3)=>Promise.race([t,new Promise(((t,s)=>{setTimeout((()=>{s(new Error("请求超时"))}),e)}))]))(i,t.timeout):i}get(t){return this.send.call(this.env,t)}post(t){return this.send.call(this.env,t,"POST")}}return new class{constructor(t,e){this.logLevels={debug:0,info:1,warn:2,error:3},this.logLevelPrefixs={debug:"[DEBUG] ",info:"[INFO] ",warn:"[WARN] ",error:"[ERROR] "},this.logLevel="info",this.name=t,this.http=new s(this),this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.isNeedRewrite=!1,this.logSeparator="\n",this.encoding="utf-8",this.startTime=(new Date).getTime(),Object.assign(this,e),this.log("",`🔔${this.name}, 开始!`)}getEnv(){return"undefined"!=typeof $environment&&$environment["surge-version"]?"Surge":"undefined"!=typeof $environment&&$environment["stash-version"]?"Stash":"undefined"!=typeof module&&module.exports?"Node.js":"undefined"!=typeof $task?"Quantumult X":"undefined"!=typeof $loon?"Loon":"undefined"!=typeof $rocket?"Shadowrocket":void 0}isNode(){return"Node.js"===this.getEnv()}isQuanX(){return"Quantumult X"===this.getEnv()}isSurge(){return"Surge"===this.getEnv()}isLoon(){return"Loon"===this.getEnv()}isShadowrocket(){return"Shadowrocket"===this.getEnv()}isStash(){return"Stash"===this.getEnv()}toObj(t,e=null){try{return JSON.parse(t)}catch{return e}}toStr(t,e=null,...s){try{return JSON.stringify(t,...s)}catch{return e}}getjson(t,e){let s=e;if(this.getdata(t))try{s=JSON.parse(this.getdata(t))}catch{}return s}setjson(t,e){try{return this.setdata(JSON.stringify(t),e)}catch{return!1}}getScript(t){return new Promise((e=>{this.get({url:t},((t,s,i)=>e(i)))}))}runScript(t,e){return new Promise((s=>{let i=this.getdata("@chavy_boxjs_userCfgs.httpapi");i=i?i.replace(/\n/g,"").trim():i;let o=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");o=o?1*o:20,o=e&&e.timeout?e.timeout:o;const[r,a]=i.split("@"),n={url:`http://${a}/v1/scripting/evaluate`,body:{script_text:t,mock_type:"cron",timeout:o},headers:{"X-Key":r,Accept:"*/*"},policy:"DIRECT",timeout:o};this.post(n,((t,e,i)=>s(i)))})).catch((t=>this.logErr(t)))}loaddata(){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e);if(!s&&!i)return{};{const i=s?t:e;try{return JSON.parse(this.fs.readFileSync(i))}catch(t){return{}}}}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e),o=JSON.stringify(this.data);s?this.fs.writeFileSync(t,o):i?this.fs.writeFileSync(e,o):this.fs.writeFileSync(t,o)}}lodash_get(t,e,s){const i=e.replace(/\[(\d+)\]/g,".$1").split(".");let o=t;for(const t of i)if(o=Object(o)[t],void 0===o)return s;return o}lodash_set(t,e,s){return Object(t)!==t||(Array.isArray(e)||(e=e.toString().match(/[^.[\]]+/g)||[]),e.slice(0,-1).reduce(((t,s,i)=>Object(t[s])===t[s]?t[s]:t[s]=Math.abs(e[i+1])>>0==+e[i+1]?[]:{}),t)[e[e.length-1]]=s),t}getdata(t){let e=this.getval(t);if(/^@/.test(t)){const[,s,i]=/^@(.*?)\.(.*?)$/.exec(t),o=s?this.getval(s):"";if(o)try{const t=JSON.parse(o);e=t?this.lodash_get(t,i,""):e}catch(t){e=""}}return e}setdata(t,e){let s=!1;if(/^@/.test(e)){const[,i,o]=/^@(.*?)\.(.*?)$/.exec(e),r=this.getval(i),a=i?"null"===r?null:r||"{}":"{}";try{const e=JSON.parse(a);this.lodash_set(e,o,t),s=this.setval(JSON.stringify(e),i)}catch(e){const r={};this.lodash_set(r,o,t),s=this.setval(JSON.stringify(r),i)}}else s=this.setval(t,e);return s}getval(t){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":return $persistentStore.read(t);case"Quantumult X":return $prefs.valueForKey(t);case"Node.js":return this.data=this.loaddata(),this.data[t];default:return this.data&&this.data[t]||null}}setval(t,e){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":return $persistentStore.write(t,e);case"Quantumult X":return $prefs.setValueForKey(t,e);case"Node.js":return this.data=this.loaddata(),this.data[e]=t,this.writedata(),!0;default:return this.data&&this.data[e]||null}}initGotEnv(t){this.got=this.got?this.got:require("got"),this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,t&&(t.headers=t.headers?t.headers:{},t&&(t.headers=t.headers?t.headers:{},void 0===t.headers.cookie&&void 0===t.headers.Cookie&&void 0===t.cookieJar&&(t.cookieJar=this.ckjar)))}get(t,e=(()=>{})){switch(t.headers&&(delete t.headers["Content-Type"],delete t.headers["Content-Length"],delete t.headers["content-type"],delete t.headers["content-length"]),t.params&&(t.url+="?"+this.queryStr(t.params)),void 0===t.followRedirect||t.followRedirect||((this.isSurge()||this.isLoon())&&(t["auto-redirect"]=!1),this.isQuanX()&&(t.opts?t.opts.redirection=!1:t.opts={redirection:!1})),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.get(t,((t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status?s.status:s.statusCode,s.status=s.statusCode),e(t,s,i)}));break;case"Quantumult X":this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then((t=>{const{statusCode:s,statusCode:i,headers:o,body:r,bodyBytes:a}=t;e(null,{status:s,statusCode:i,headers:o,body:r,bodyBytes:a},r,a)}),(t=>e(t&&t.error||"UndefinedError")));break;case"Node.js":let s=require("iconv-lite");this.initGotEnv(t),this.got(t).on("redirect",((t,e)=>{try{if(t.headers["set-cookie"]){const s=t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();s&&this.ckjar.setCookieSync(s,null),e.cookieJar=this.ckjar}}catch(t){this.logErr(t)}})).then((t=>{const{statusCode:i,statusCode:o,headers:r,rawBody:a}=t,n=s.decode(a,this.encoding);e(null,{status:i,statusCode:o,headers:r,rawBody:a,body:n},n)}),(t=>{const{message:i,response:o}=t;e(i,o,o&&s.decode(o.rawBody,this.encoding))}));break}}post(t,e=(()=>{})){const s=t.method?t.method.toLocaleLowerCase():"post";switch(t.body&&t.headers&&!t.headers["Content-Type"]&&!t.headers["content-type"]&&(t.headers["content-type"]="application/x-www-form-urlencoded"),t.headers&&(delete t.headers["Content-Length"],delete t.headers["content-length"]),void 0===t.followRedirect||t.followRedirect||((this.isSurge()||this.isLoon())&&(t["auto-redirect"]=!1),this.isQuanX()&&(t.opts?t.opts.redirection=!1:t.opts={redirection:!1})),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient[s](t,((t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status?s.status:s.statusCode,s.status=s.statusCode),e(t,s,i)}));break;case"Quantumult X":t.method=s,this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then((t=>{const{statusCode:s,statusCode:i,headers:o,body:r,bodyBytes:a}=t;e(null,{status:s,statusCode:i,headers:o,body:r,bodyBytes:a},r,a)}),(t=>e(t&&t.error||"UndefinedError")));break;case"Node.js":let i=require("iconv-lite");this.initGotEnv(t);const{url:o,...r}=t;this.got[s](o,r).then((t=>{const{statusCode:s,statusCode:o,headers:r,rawBody:a}=t,n=i.decode(a,this.encoding);e(null,{status:s,statusCode:o,headers:r,rawBody:a,body:n},n)}),(t=>{const{message:s,response:o}=t;e(s,o,o&&i.decode(o.rawBody,this.encoding))}));break}}time(t,e=null){const s=e?new Date(e):new Date;let i={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length)));for(let e in i)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?i[e]:("00"+i[e]).substr((""+i[e]).length)));return t}queryStr(t){let e="";for(const s in t){let i=t[s];null!=i&&""!==i&&("object"==typeof i&&(i=JSON.stringify(i)),e+=`${s}=${i}&`)}return e=e.substring(0,e.length-1),e}msg(e=t,s="",i="",o={}){const r=t=>{const{$open:e,$copy:s,$media:i,$mediaMime:o}=t;switch(typeof t){case void 0:return t;case"string":switch(this.getEnv()){case"Surge":case"Stash":default:return{url:t};case"Loon":case"Shadowrocket":return t;case"Quantumult X":return{"open-url":t};case"Node.js":return}case"object":switch(this.getEnv()){case"Surge":case"Stash":case"Shadowrocket":default:{const r={};let a=t.openUrl||t.url||t["open-url"]||e;a&&Object.assign(r,{action:"open-url",url:a});let n=t["update-pasteboard"]||t.updatePasteboard||s;if(n&&Object.assign(r,{action:"clipboard",text:n}),i){let t,e,s;if(i.startsWith("http"))t=i;else if(i.startsWith("data:")){const[t]=i.split(";"),[,o]=i.split(",");e=o,s=t.replace("data:","")}else{e=i,s=(t=>{const e={JVBERi0:"application/pdf",R0lGODdh:"image/gif",R0lGODlh:"image/gif",iVBORw0KGgo:"image/png","/9j/":"image/jpg"};for(var s in e)if(0===t.indexOf(s))return e[s];return null})(i)}Object.assign(r,{"media-url":t,"media-base64":e,"media-base64-mime":o??s})}return Object.assign(r,{"auto-dismiss":t["auto-dismiss"],sound:t.sound}),r}case"Loon":{const s={};let o=t.openUrl||t.url||t["open-url"]||e;o&&Object.assign(s,{openUrl:o});let r=t.mediaUrl||t["media-url"];return i?.startsWith("http")&&(r=i),r&&Object.assign(s,{mediaUrl:r}),console.log(JSON.stringify(s)),s}case"Quantumult X":{const o={};let r=t["open-url"]||t.url||t.openUrl||e;r&&Object.assign(o,{"open-url":r});let a=t["media-url"]||t.mediaUrl;i?.startsWith("http")&&(a=i),a&&Object.assign(o,{"media-url":a});let n=t["update-pasteboard"]||t.updatePasteboard||s;return n&&Object.assign(o,{"update-pasteboard":n}),console.log(JSON.stringify(o)),o}case"Node.js":return}default:return}};if(!this.isMute)switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:$notification.post(e,s,i,r(o));break;case"Quantumult X":$notify(e,s,i,r(o));break;case"Node.js":break}if(!this.isMuteLog){let t=["","==============📣系统通知📣=============="];t.push(e),s&&t.push(s),i&&t.push(i),console.log(t.join("\n")),this.logs=this.logs.concat(t)}}debug(...t){this.logLevels[this.logLevel]<=this.logLevels.debug&&(t.length>0&&(this.logs=[...this.logs,...t]),console.log(`${this.logLevelPrefixs.debug}${t.map((t=>t??String(t))).join(this.logSeparator)}`))}info(...t){this.logLevels[this.logLevel]<=this.logLevels.info&&(t.length>0&&(this.logs=[...this.logs,...t]),console.log(`${this.logLevelPrefixs.info}${t.map((t=>t??String(t))).join(this.logSeparator)}`))}warn(...t){this.logLevels[this.logLevel]<=this.logLevels.warn&&(t.length>0&&(this.logs=[...this.logs,...t]),console.log(`${this.logLevelPrefixs.warn}${t.map((t=>t??String(t))).join(this.logSeparator)}`))}error(...t){this.logLevels[this.logLevel]<=this.logLevels.error&&(t.length>0&&(this.logs=[...this.logs,...t]),console.log(`${this.logLevelPrefixs.error}${t.map((t=>t??String(t))).join(this.logSeparator)}`))}log(...t){t.length>0&&(this.logs=[...this.logs,...t]),console.log(t.map((t=>t??String(t))).join(this.logSeparator))}logErr(t,e){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":case"Quantumult X":default:this.log("",`❗️${this.name}, 错误!`,e,t);break;case"Node.js":this.log("",`❗️${this.name}, 错误!`,e,void 0!==t.message?t.message:t,t.stack);break}}wait(t){return new Promise((e=>setTimeout(e,t)))}done(t={}){const e=((new Date).getTime()-this.startTime)/1e3;switch(this.log("",`🔔${this.name}, 结束! 🕛 ${e} 秒`),this.log(),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":case"Quantumult X":default:$done(t);break;case"Node.js":process.exit(1)}}}(t,e)}
